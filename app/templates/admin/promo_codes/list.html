{% extends 'admin/base.html' %}

{% block title %}Promo Codes{% endblock %}

{% block breadcrumbs %}
{% set breadcrumbs = [
    {'name': 'Event Management'},
    {'name': 'Promo Codes'}
] %}
{% include 'admin/partials/breadcrumbs.html' %}
{% endblock %}

{% block content %}
<div class="sm:flex sm:items-center">
    <div class="sm:flex-auto">
        <h1 class="text-base font-semibold text-gray-900">Promo Codes</h1>
        <p class="mt-2 text-sm text-gray-700">Manage promotional codes for discounts and special offers.</p>
    </div>
    <div class="mt-4 sm:ml-16 sm:mt-0 sm:flex-none">
        <a href="{{ url_for('admin.create_promo_code') }}" class="block rounded-md bg-green-600 px-3 py-2 text-center text-sm font-semibold text-white shadow-sm hover:bg-green-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-green-600">
            Create Promo Code
        </a>
    </div>
</div>

<!-- Table -->
<div class="-mx-4 mt-10 ring-1 ring-gray-300 sm:mx-0 sm:rounded-lg">
    <table class="relative min-w-full divide-y divide-gray-300">
        <thead>
            <tr>
                <th scope="col" class="py-3.5 pl-4 pr-3 text-left text-sm font-semibold text-gray-900 sm:pl-6">Code</th>
                <th scope="col" class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">Description</th>
                <th scope="col" class="hidden px-3 py-3.5 text-left text-sm font-semibold text-gray-900 lg:table-cell">Discount</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Usage</th>
                <th scope="col" class="px-3 py-3.5 text-left text-sm font-semibold text-gray-900">Status</th>
                <th scope="col" class="py-3.5 pl-3 pr-4 sm:pr-6">
                    <span class="sr-only">Actions</span>
                </th>
            </tr>
        </thead>
        <tbody>
            {% for promo in promo_codes %}
            <tr>
                <td class="relative py-4 pl-4 pr-3 text-sm sm:pl-6">
                    <div class="font-medium text-gray-900">{{ promo.code }}</div>
                    <div class="mt-1 flex flex-col text-gray-500 sm:block lg:hidden">
                        <span>{{ promo.discount_type|title }}: {{ promo.discount_value }}{{ '%' if promo.discount_type == 'percentage' else ' TZS' }}</span>
                        <span class="hidden sm:inline">·</span>
                        <span>Used: {{ promo.times_used }}/{{ promo.usage_limit if promo.usage_limit else '∞' }}</span>
                    </div>
                    {% if not loop.first %}
                    <div class="absolute -top-px left-6 right-0 h-px bg-gray-200"></div>
                    {% endif %}
                </td>
                <td class="hidden {% if not loop.first %}border-t border-gray-200{% else %}border-t border-transparent{% endif %} px-3 py-3.5 text-sm text-gray-500 lg:table-cell">
                    {{ promo.description if promo.description else '-' }}
                </td>
                <td class="hidden {% if not loop.first %}border-t border-gray-200{% else %}border-t border-transparent{% endif %} px-3 py-3.5 text-sm text-gray-500 lg:table-cell">
                    {% if promo.discount_type == 'percentage' %}
                    <span class="inline-flex items-center rounded-md bg-blue-50 px-2 py-1 text-xs font-medium text-blue-700 ring-1 ring-inset ring-blue-700/10">{{ promo.discount_value }}% off</span>
                    {% else %}
                    <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">TZS {{ "{:,.0f}".format(promo.discount_value) }} off</span>
                    {% endif %}
                </td>
                <td class="{% if not loop.first %}border-t border-gray-200{% else %}border-t border-transparent{% endif %} px-3 py-3.5 text-sm text-gray-500">
                    <div class="sm:hidden">{{ promo.times_used }}/{{ promo.usage_limit if promo.usage_limit else '∞' }}</div>
                    <div class="hidden sm:block">
                        {{ promo.times_used }} / {{ promo.usage_limit if promo.usage_limit else 'Unlimited' }}
                        {% if promo.usage_limit and promo.times_used >= promo.usage_limit %}
                        <span class="ml-1 text-xs text-red-600">(Limit reached)</span>
                        {% endif %}
                    </div>
                </td>
                <td class="{% if not loop.first %}border-t border-gray-200{% else %}border-t border-transparent{% endif %} px-3 py-3.5 text-sm text-gray-500">
                    {% if promo.is_active and (not promo.expires_at or promo.expires_at > now()) %}
                    <span class="inline-flex items-center rounded-md bg-green-50 px-2 py-1 text-xs font-medium text-green-700 ring-1 ring-inset ring-green-600/20">Active</span>
                    {% elif promo.expires_at and promo.expires_at <= now() %}
                    <span class="inline-flex items-center rounded-md bg-red-50 px-2 py-1 text-xs font-medium text-red-700 ring-1 ring-inset ring-red-600/20">Expired</span>
                    {% else %}
                    <span class="inline-flex items-center rounded-md bg-gray-50 px-2 py-1 text-xs font-medium text-gray-600 ring-1 ring-inset ring-gray-500/10">Inactive</span>
                    {% endif %}
                </td>
                <td class="relative {% if not loop.first %}border-t border-transparent{% endif %} py-3.5 pl-3 pr-4 text-right text-sm font-medium sm:pr-6">
                    <a href="{{ url_for('admin.promo_code_usage', id=promo.id) }}" class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 mr-2">
                        Usage
                    </a>
                    <a href="{{ url_for('admin.edit_promo_code', id=promo.id) }}" class="inline-flex items-center rounded-md bg-white px-2.5 py-1.5 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50">
                        Edit<span class="sr-only">, {{ promo.code }}</span>
                    </a>
                    {% if not loop.first %}
                    <div class="absolute -top-px left-0 right-6 h-px bg-gray-200"></div>
                    {% endif %}
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="px-3 py-8 text-center text-sm text-gray-500">
                    <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" />
                    </svg>
                    <p class="mt-2">No promo codes created</p>
                    <p class="mt-1 text-xs text-gray-400">Get started by creating a new promo code</p>
                    <div class="mt-4">
                        <a href="{{ url_for('admin.create_promo_code') }}" class="inline-flex items-center rounded-md bg-green-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-green-500">
                            Create Promo Code
                        </a>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
