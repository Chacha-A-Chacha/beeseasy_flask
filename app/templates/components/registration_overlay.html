{# Registration Coming Soon Overlay Component #} {# Shows when registration is
not yet open #}

<div
    id="registrationOverlay"
    class="fixed inset-0 bg-gray-900/80 backdrop-blur-sm z-50 flex items-center justify-center p-4"
    style="display: none"
>
    <div
        class="bg-white rounded-2xl shadow-2xl max-w-md lg:max-w-lg w-full mx-4 border-4 border-accent-yellow relative overflow-hidden"
    >
        {# Decorative Background Pattern #}
        <div
            class="absolute inset-0 opacity-5"
            style="background-image: url('{{ url_for('static', filename='images/speakers/pattern.svg') }}'); background-size: cover;"
        ></div>

        {# Content #}
        <div class="relative p-8 text-center">
            {# Icon #}
            <div
                class="mx-auto flex items-center justify-center w-24 h-24 bg-accent-yellow/10 rounded-full mb-6"
            >
                <svg
                    class="h-12 w-12 text-accent-orange"
                    fill="none"
                    viewBox="0 0 24 24"
                    stroke-width="2"
                    stroke="currentColor"
                >
                    <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5"
                    />
                </svg>
            </div>

            {# Heading #}
            <h3 class="text-3xl font-bold text-primary-dark mb-3">
                Registration Opening Soon!
            </h3>

            {# Message #}
            <p class="text-gray-600 mb-6">
                Be the first to know when registration opens for
                <span class="font-semibold text-primary-dark"
                    >{{ event_name }}</span
                >.
            </p>

            {# Email Subscription Form #}
            <form id="overlayNewsletterForm" class="mb-6">
                <div class="flex items-center gap-3">
                    <input
                        type="email"
                        id="overlayEmail"
                        name="email"
                        placeholder="Enter your email"
                        required
                        class="flex-1 rounded-full border-0 bg-white px-4 py-3 text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 placeholder:text-gray-400 focus:ring-2 focus:ring-inset focus:ring-accent-orange text-base"
                    />
                    <button
                        type="submit"
                        id="overlaySubmitBtn"
                        class="flex-none rounded-full bg-accent-orange px-6 py-3 text-base font-semibold text-white shadow-lg hover:bg-accent-yellow hover:text-primary-dark transition-all duration-300"
                    >
                        Notify Me
                    </button>
                </div>
                <p id="overlayFormMessage" class="mt-3 text-sm hidden"></p>
            </form>

            {# Close Button #}
            <button
                onclick="closeRegistrationOverlay()"
                class="w-full px-6 py-3 bg-transparent border-2 border-gray-300 text-gray-700 font-semibold rounded-full hover:border-primary-dark hover:text-primary-dark transition-all duration-300"
            >
                Continue Browsing
            </button>

            {# Social Proof #}
            <p class="mt-6 text-xs text-gray-500">
                Join
                <span class="font-bold text-primary-dark">500+</span>
                participants from across Africa
            </p>
        </div>
    </div>
</div>

{# JavaScript for Overlay Control #}
<script>
    // Get CSRF token from meta tag
    function getCSRFToken() {
        return document
            .querySelector('meta[name="csrf-token"]')
            ?.getAttribute("content");
    }

    // Show overlay when registration links are clicked
    function showRegistrationOverlay(event) {
        event.preventDefault();
        const overlay = document.getElementById("registrationOverlay");
        if (overlay) {
            overlay.style.display = "flex";
            document.body.style.overflow = "hidden"; // Prevent scrolling
        }
    }

    // Close overlay
    function closeRegistrationOverlay() {
        const overlay = document.getElementById("registrationOverlay");
        if (overlay) {
            overlay.style.display = "none";
            document.body.style.overflow = ""; // Restore scrolling
        }
    }

    // Show message in overlay
    function showOverlayMessage(message, isError = false) {
        const messageEl = document.getElementById("overlayFormMessage");
        messageEl.textContent = message;
        messageEl.className = `mt-3 text-sm ${isError ? "text-red-600" : "text-green-600"}`;
        messageEl.classList.remove("hidden");
    }

    // Close on ESC key
    document.addEventListener("keydown", function (event) {
        if (event.key === "Escape") {
            closeRegistrationOverlay();
        }
    });

    // Close when clicking outside the modal
    document
        .getElementById("registrationOverlay")
        ?.addEventListener("click", function (event) {
            if (event.target === this) {
                closeRegistrationOverlay();
            }
        });

    // Attach event listeners to all registration links
    document.addEventListener("DOMContentLoaded", function () {
        // Select all links that contain registration routes
        const registrationLinks = document.querySelectorAll(
            'a[href*="/register/"]',
        );
        registrationLinks.forEach((link) => {
            link.addEventListener("click", showRegistrationOverlay);
        });

        // Handle overlay newsletter form submission
        const overlayForm = document.getElementById("overlayNewsletterForm");
        if (overlayForm) {
            overlayForm.addEventListener("submit", async function (e) {
                e.preventDefault();

                const emailInput = document.getElementById("overlayEmail");
                const submitBtn = document.getElementById("overlaySubmitBtn");
                const messageEl = document.getElementById("overlayFormMessage");

                const email = emailInput.value.trim();

                if (!email) {
                    showOverlayMessage("Please enter your email address", true);
                    return;
                }

                // Disable form
                submitBtn.disabled = true;
                submitBtn.textContent = "Subscribing...";
                messageEl.classList.add("hidden");

                try {
                    const response = await fetch("/newsletter/subscribe", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "X-CSRFToken": getCSRFToken(),
                        },
                        body: JSON.stringify({
                            email: email,
                            source: "overlay",
                        }),
                    });

                    const data = await response.json();

                    if (data.success) {
                        showOverlayMessage(data.message, false);
                        emailInput.value = "";
                        setTimeout(() => {
                            closeRegistrationOverlay();
                        }, 3000);
                    } else {
                        showOverlayMessage(data.message, true);
                    }
                } catch (error) {
                    showOverlayMessage(
                        "An error occurred. Please try again.",
                        true,
                    );
                } finally {
                    submitBtn.disabled = false;
                    submitBtn.textContent = "Notify Me";
                }
            });
        }
    });
</script>
