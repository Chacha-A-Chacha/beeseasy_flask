{% extends "base.html" %}
{% block title %}Select Payment Method - {{ event_name }}{% endblock %}

{% block content %}

<!-- Hero Section -->
<div class="relative isolate overflow-hidden bg-gradient-to-r from-primary-dark to-primary-medium py-16 sm:py-20">
    <!-- Decorative background elements -->
    <div aria-hidden="true" class="hidden sm:absolute sm:-top-10 sm:right-1/2 sm:-z-10 sm:mr-10 sm:block sm:transform-gpu sm:blur-3xl">
        <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%);" class="aspect-[1097/845] w-[68.5625rem] bg-gradient-to-tr from-yellow-400 to-accent-orange opacity-20"></div>
    </div>

    <div class="mx-auto max-w-7xl px-6 lg:px-8">
        <div class="mx-auto max-w-3xl text-center">
            <h1 class="text-4xl font-bold tracking-tight text-white sm:text-5xl">
                Complete Your Payment
            </h1>
            <p class="mt-4 text-lg text-[#F5C342]">
                Secure payment powered by DPO Pay
            </p>
            <p class="mt-3 text-base text-white/90">
                Choose your preferred payment method below
            </p>
        </div>
    </div>
</div>

<!-- Main Content -->
<div class="container mx-auto px-4 py-12">
    <div class="max-w-5xl mx-auto">
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- LEFT SIDEBAR - Order Summary (Sticky) -->
            <div class="lg:col-span-1">
                <div class="bg-white rounded-lg shadow-lg border-2 border-accent-yellow sticky top-6">
                    <div class="bg-gradient-to-r from-accent-yellow to-accent-orange p-4">
                        <h3 class="text-lg font-bold text-primary-dark">Payment Summary</h3>
                    </div>

                    <div class="p-6">
                        <!-- Reference Number -->
                        <div class="mb-4">
                            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Reference Number</p>
                            <p class="font-mono font-bold text-primary-dark">{{ registration.reference_number }}</p>
                        </div>

                        <!-- Registrant Info -->
                        <div class="mb-4 pb-4 border-b border-gray-200">
                            <p class="text-xs text-gray-500 uppercase tracking-wide mb-1">Registrant</p>
                            {% if registration.registration_type == 'attendee' %}
                            <p class="font-semibold text-primary-dark">
                                {{ registration.attendee_registration.first_name }} {{ registration.attendee_registration.last_name }}
                            </p>
                            {% else %}
                            <p class="font-semibold text-primary-dark">{{ registration.exhibitor_registration.contact_person_name }}</p>
                            {% endif %}
                            <p class="text-sm text-gray-600">{{ registration.email }}</p>
                        </div>

                        <!-- Amount Due -->
                        <div class="mb-4 pt-4 border-t-2 border-gray-200">
                            <div class="flex justify-between items-center">
                                <span class="text-base font-bold text-primary-dark">Amount Due</span>
                                <div class="text-right">
                                    <div class="text-sm text-gray-600">{{ payment.currency }}</div>
                                    <div class="text-2xl font-bold text-accent-orange">
                                        {{ "%.2f"|format(payment.total_amount) }}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Security Badge -->
                        <div class="mt-6 pt-4 border-t border-gray-200 text-center">
                            <div class="flex items-center justify-center text-xs text-gray-500">
                                <svg class="w-4 h-4 text-green-600 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                </svg>
                                Secure payment • DPO Pay
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT SIDE - Payment Method Selection -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-lg p-8">
                    <h2 class="text-2xl font-bold text-primary-dark mb-2">Select Payment Method</h2>
                    <p class="text-gray-600 mb-6">All methods are secure and encrypted</p>

                    <form method="POST" id="dpoPaymentForm">
                        {{ csrf_token() }}

                        <!-- Payment Method Options -->
                        <div class="space-y-4 mb-8">
                            <!-- M-Pesa (Vodacom) -->
                            <label class="payment-method-card relative flex cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 shadow-sm hover:border-accent-yellow transition-all focus:outline-none" data-method="mpesa">
                                <input type="radio" name="payment_type" value="mpesa" class="sr-only" required />
                                <span class="flex flex-1">
                                    <span class="flex flex-col">
                                        <span class="flex items-center">
                                            <svg class="w-6 h-6 text-green-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                            <span class="block text-lg font-bold text-gray-900">M-Pesa (Vodacom)</span>
                                        </span>
                                        <span class="mt-2 flex items-center text-sm text-gray-500">
                                            <span>Mobile money • Tanzania • Instant confirmation</span>
                                        </span>
                                        <span class="mt-1 text-xs text-green-600 font-semibold">✓ Recommended for Tanzania</span>
                                    </span>
                                </span>
                                <svg class="h-5 w-5 text-accent-yellow payment-check hidden" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </label>

                            <!-- Tigo Pesa -->
                            <label class="payment-method-card relative flex cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 shadow-sm hover:border-accent-yellow transition-all focus:outline-none" data-method="tigo">
                                <input type="radio" name="payment_type" value="tigo" class="sr-only" />
                                <span class="flex flex-1">
                                    <span class="flex flex-col">
                                        <span class="flex items-center">
                                            <svg class="w-6 h-6 text-blue-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                            <span class="block text-lg font-bold text-gray-900">Tigo Pesa</span>
                                        </span>
                                        <span class="mt-2 flex items-center text-sm text-gray-500">
                                            <span>Mobile money • Tanzania • Instant confirmation</span>
                                        </span>
                                    </span>
                                </span>
                                <svg class="h-5 w-5 text-accent-yellow payment-check hidden" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </label>

                            <!-- Airtel Money -->
                            <label class="payment-method-card relative flex cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 shadow-sm hover:border-accent-yellow transition-all focus:outline-none" data-method="airtel">
                                <input type="radio" name="payment_type" value="airtel" class="sr-only" />
                                <span class="flex flex-1">
                                    <span class="flex flex-col">
                                        <span class="flex items-center">
                                            <svg class="w-6 h-6 text-red-600 mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                            <span class="block text-lg font-bold text-gray-900">Airtel Money</span>
                                        </span>
                                        <span class="mt-2 flex items-center text-sm text-gray-500">
                                            <span>Mobile money • Tanzania • Instant confirmation</span>
                                        </span>
                                    </span>
                                </span>
                                <svg class="h-5 w-5 text-accent-yellow payment-check hidden" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </label>

                            <!-- Credit/Debit Card -->
                            <label class="payment-method-card relative flex cursor-pointer rounded-lg border-2 border-gray-200 bg-white p-4 shadow-sm hover:border-accent-yellow transition-all focus:outline-none" data-method="card">
                                <input type="radio" name="payment_type" value="card" class="sr-only" />
                                <span class="flex flex-1">
                                    <span class="flex flex-col">
                                        <span class="flex items-center">
                                            <svg class="w-6 h-6 text-accent-orange mr-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                                            </svg>
                                            <span class="block text-lg font-bold text-gray-900">Credit/Debit Card</span>
                                        </span>
                                        <span class="mt-2 flex items-center text-sm text-gray-500">
                                            <span>Visa, Mastercard, American Express • International payments</span>
                                        </span>
                                    </span>
                                </span>
                                <svg class="h-5 w-5 text-accent-yellow payment-check hidden" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                                </svg>
                            </label>
                        </div>

                        <!-- Submit Buttons -->
                        <div class="flex flex-col sm:flex-row gap-4">
                            <button type="submit" class="flex-1 px-8 py-4 bg-accent-orange text-white font-bold rounded-lg hover:bg-accent-yellow hover:text-primary-dark transition-all shadow-md hover:shadow-lg text-lg">
                                <span class="flex items-center justify-center">
                                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                                    </svg>
                                    Proceed to Payment
                                </span>
                            </button>
                            <a href="{{ url_for('payments.checkout', ref=registration.reference_number) }}" class="px-8 py-4 border-2 border-gray-300 text-gray-700 font-semibold rounded-lg hover:border-accent-yellow hover:text-primary-dark transition-all text-center">
                                Back
                            </a>
                        </div>

                        <p class="text-xs text-gray-500 mt-4 text-center">
                            You will be redirected to DPO Pay to complete your payment securely.
                        </p>
                    </form>
                </div>

                <!-- Payment Information -->
                <div class="mt-6 bg-blue-50 border border-blue-200 rounded-lg p-6">
                    <div class="flex items-start">
                        <svg class="w-6 h-6 text-blue-600 mr-3 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <div>
                            <h3 class="font-semibold text-blue-900 mb-2">How It Works</h3>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li>• Select your preferred payment method above</li>
                                <li>• You will be redirected to DPO Pay's secure payment page</li>
                                <li>• Complete your payment using your chosen method</li>
                                <li>• You will be redirected back with instant confirmation</li>
                                <li>• A receipt will be sent to {{ registration.email }}</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Payment Method Selection JavaScript -->
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const paymentCards = document.querySelectorAll(".payment-method-card");
        const form = document.getElementById("dpoPaymentForm");

        // Handle payment method selection
        paymentCards.forEach((card) => {
            card.addEventListener("click", function () {
                // Remove selection from all cards
                paymentCards.forEach((c) => {
                    c.classList.remove("border-accent-yellow", "bg-accent-yellow/5");
                    c.querySelector(".payment-check").classList.add("hidden");
                });

                // Add selection to clicked card
                this.classList.add("border-accent-yellow", "bg-accent-yellow/5");
                this.querySelector(".payment-check").classList.remove("hidden");

                // Check the radio button
                this.querySelector('input[type="radio"]').checked = true;
            });
        });

        // Form submission validation
        form.addEventListener("submit", function (e) {
            const selectedMethod = document.querySelector('input[name="payment_type"]:checked');

            if (!selectedMethod) {
                e.preventDefault();
                alert("Please select a payment method to continue.");
                return false;
            }
        });
    });
</script>

<style>
    /* Payment method card hover effects */
    .payment-method-card {
        transition: all 0.2s ease;
    }

    .payment-method-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    }

    /* Checked state styling */
    .payment-method-card:has(input:checked) {
        border-color: rgb(245 195 66) !important; /* accent-yellow */
        background-color: rgba(245, 195, 66, 0.05);
    }

    .payment-method-card:has(input:checked) .payment-check {
        display: block !important;
    }
</style>

{% endblock %}
